<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Svenska Travbanor â€“ VÃ¤der & Temperatur</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    .weather-icon {
      width: 34px;
      vertical-align: middle;
    }
  </style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3d91">

<!-- iOS PWA tweaks -->
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Skapa Sverige-kartan
    const map = L.map('map').setView([62.0, 15.0], 5);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Travbanorna
   const tracks = [
  // Norra / mellersta Norrland
  { name: "BergsÃ¥ker",               lat: 62.4158, lon: 17.2165 },   // exakta, Koordinater.se
  { name: "Dannero",                 lat: 63.0198, lon: 17.7932 },   // exakta, Koordinater.se
  { name: "SolÃ¤nget",                lat: 63.291,  lon: 18.72   },
  { name: "Hoting",                  lat: 64.105,  lon: 16.189  },
  { name: "SkellefteÃ¥",              lat: 64.751,  lon: 20.95   },
  { name: "UmÃ¥ker",                  lat: 63.8102, lon: 20.1949 },   // exakta, Koordinater.se
  { name: "Lycksele",                lat: 64.595,  lon: 18.676  },
  { name: "Haparanda",               lat: 65.838,  lon: 24.127  },
  { name: "Ã–stersund",               lat: 63.179,  lon: 14.66   },
  { name: "JÃ¤mtlandsbanan (Ã–stersund)", lat: 63.179, lon: 14.66 },   // samma omrÃ¥de, separat markÃ¶r om du vill

  // Mellansverige
  { name: "BollnÃ¤s",                 lat: 61.3417, lon: 16.3351 },   // exakta, Koordinater.se
  { name: "Hagmyren",                lat: 61.732,  lon: 16.807  },
  { name: "GÃ¤vle",                   lat: 60.6903, lon: 17.1342 },   // exakta, Koordinater.se
  { name: "RÃ¤ttvik",                 lat: 60.883,  lon: 15.134  },
  { name: "Romme",                   lat: 60.474,  lon: 15.437  },
  { name: "Lindesberg",              lat: 59.602,  lon: 15.236  },
  { name: "Ã–rebro",                  lat: 59.303,  lon: 15.206  },

  // MÃ¤lardalen / runt Stockholm
  { name: "Solvalla",                lat: 59.3668, lon: 17.9462 },   // exakta, Koordinater.se
  { name: "Eskilstuna (Sundbyholm)", lat: 59.4386, lon: 16.6143 },   // exakta, Koordinater.se
  { name: "Mantorp",                 lat: 58.347,  lon: 15.287  },

  // VÃ¤stra / sydvÃ¤stra Sverige
  { name: "Ã…by",                     lat: 57.6495, lon: 12.0033 },   // GPS frÃ¥n Ã…bytravet (omrÃ¤knat till decimal)
  { name: "Ã…mÃ¥l",                    lat: 59.051,  lon: 12.708  },
  { name: "Ã…rjÃ¤ng",                  lat: 59.392,  lon: 12.135  },
  { name: "FÃ¤rjestad",               lat: 59.4091, lon: 13.5035 },   // exakta, Koordinater.se
  { name: "Karlshamn",               lat: 56.171,  lon: 14.867  },
  { name: "Vaggeryd",                lat: 57.5,    lon: 14.14   },

  // SÃ¶dra / sydÃ¶stra Sverige
  { name: "Halmstad",                lat: 56.6927, lon: 12.9259 },   // exakta, Koordinater.se
  { name: "JÃ¤gersro",                lat: 55.5735, lon: 13.0624 },   // exakta, Koordinater.se
  { name: "Kalmar",                  lat: 56.700,  lon: 16.308  },
  { name: "Tingsryd",                lat: 56.529,  lon: 14.976  },
  { name: "Visby",                   lat: 57.634,  lon: 18.307  },

  // Ã–vriga mindre banor / sommarbanor
  { name: "Ã…sele",                   lat: 64.162,  lon: 17.347  },
  { name: "Oviken",                  lat: 62.995,  lon: 14.443  }
];

    const markers = [];

    // HÃ¤mta vÃ¤der frÃ¥n Open-Meteo
    function fetchWeatherFor(track, marker) {
      const url =
        `https://api.open-meteo.com/v1/forecast?latitude=${track.lat}` +
        `&longitude=${track.lon}&current_weather=true&temperature_unit=celsius`;

      fetch(url)
        .then(r => r.json())
        .then(data => {
          if (data && data.current_weather) {
            const temp = data.current_weather.temperature;
            const code = data.current_weather.weathercode;
            const icon = weatherIcon(code);

            marker.bindTooltip(
              `${track.name}: ${temp.toFixed(1)} Â°C ${icon}`,
              { permanent: true, direction: "top", offset: [0, -10] }
            ).openTooltip();

            marker.bindPopup(
              `<b>${track.name}</b><br>` +
              `Temperatur: ${temp.toFixed(1)} Â°C<br>` +
              `VÃ¤der: ${weatherDescription(code)}`
            );
          }
        });
    }

    // Ã–versÃ¤ttning av WMO weather codes
    function weatherDescription(code) {
      const table = {
        0: "Klart",
        1: "Mest klart",
        2: "Halvklart",
        3: "Mulet",
        45: "Dimma",
        48: "Dimma med rimfrost",
        51: "LÃ¤tt duggregn",
        53: "Duggregn",
        55: "Tungt duggregn",
        61: "LÃ¤tt regn",
        63: "Regn",
        65: "Kraftigt regn",
        71: "LÃ¤tt snÃ¶fall",
        73: "SnÃ¶fall",
        75: "Kraftigt snÃ¶fall",
        80: "LÃ¤tta skurar",
        81: "Skurar",
        82: "Kraftiga skurar",
        95: "Ã…ska",
        96: "Ã…ska + lÃ¤tt hagel",
        99: "Ã…ska + kraftigt hagel"
      };
      return table[code] || "OkÃ¤nt vÃ¤der";
    }

    // VÃ¤derikon emojis
    function weatherIcon(code) {
      if (code === 0) return "â˜€ï¸";
      if ([1, 2].includes(code)) return "ðŸŒ¤ï¸";
      if (code === 3) return "â˜ï¸";
      if ([45, 48].includes(code)) return "ðŸŒ«ï¸";
      if ([51, 53, 55, 61, 63, 65].includes(code)) return "ðŸŒ§ï¸";
      if ([71, 73, 75].includes(code)) return "ðŸŒ¨ï¸";
      if ([80, 81, 82].includes(code)) return "ðŸŒ¦ï¸";
      if ([95, 96, 99].includes(code)) return "â›ˆï¸";
      return "â“";
    }

    // Placera markÃ¶rer
    tracks.forEach(track => {
      const marker = L.marker([track.lat, track.lon]).addTo(map);
      markers.push({ track, marker });
      fetchWeatherFor(track, marker);
    });

    // Uppdatera var 5:e minut
    setInterval(() => {
      markers.forEach(({ track, marker }) =>
        fetchWeatherFor(track, marker)
      );
    }, 300000);
  </script>

  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", function () {
      navigator.serviceWorker
        .register("./service-worker.js")
        .catch(function (error) {
          console.log("Service worker registration failed:", error);
        });
    });
  }
</script>

</body>
</html>
